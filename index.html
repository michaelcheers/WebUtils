<html>
<head>
<style>
#textBox
{
   width: 500px;
   height: 400px;
}
</style>
</head>
<body>
<div id=p0>
    <ul>
        <li><a href="javascript:go(0)">Text Editor</a></li>
    </ul>
</div>
<div id=p1>
<input type="file" id="upload" onchange="uploadFile(0)" /><br />
Line Terminator: <input id="lineTerminator" value="\r\n" /><br />
Code Type: <select id="languageSelect" onchange="editorChange()"></select>
<div id="textBox">some text</div>
<a href="javascript:saveText()">Download</a>
</div>
<script src="Ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="Ace/theme-twilight.js" type="text/javascript" charset="utf-8"></script>
<script src="Ace/ext-modelist.js"></script>
<script>
function uploadFile(n, fileReader)
{
    switch (n)
    {
        case 0:
            var file = upload.files[0];
            //alert("Uploading file: " + file.name);
            var mode = require("ace/ext/modelist").getModeForPath(file.name).mode;
            //alert("Mode is " + mode);
            languageSelect.value = mode.substr('ace/mode/'.length);
            //alert(languageSelect.value);
            editorChange();
            var fileReader = new FileReader();
            fileReader.readAsText(file);
            fileReader.onload = function () { uploadFile(1, fileReader); };
            break;
        case 1:
            upload.value = null;
            editor.setValue(fileReader.result.replace(/\r/g, ''));
            break;
    }
}
function editorChange()
{
    currentExt = require('ace/ext/modelist').modesByName[languageSelect.value].extensions.split('|')[0];
    var script = document.createElement('script');
    script.src = 'Ace/mode-' + languageSelect.value + '.js';
    script.onload = function () {
        var cMode = require("ace/mode/" + languageSelect.value).Mode;
        editor.session.setMode(new cMode());
    };
    document.head.appendChild(script);
}
var currentExt;
var editor;
changePage(0);
function go (pageN)
{
   switch (pageN)
   {
       case 0:
           changePage(1);
           for (var language in require('ace/ext/modelist').modesByName)
           {
               var option = document.createElement('option');
               option.value = language;
               option.innerHTML = language;
               languageSelect.appendChild(option);
           }
           languageSelect.value = "csharp";
           editor = ace.edit("textBox");
           editor.setTheme("ace/theme/twilight");
           editorChange();
           break;
   }
}
function saveText ()
{
    var download = document.createElement('a');
    download.href = 'data:;base64,' + btoa(editor.getValue().replace(/\n/g, eval('\'' + lineTerminator.value + '\'')));
    download.download = "download." + currentExt;
    download.click();
}
function changePage (n)
{
    for (var index=0;index<2;index++)
    {
        document.getElementById("p" + index).style.display = n === index ? "initial" : "none";
    }
}
</script>
</body>
</html>
